<!doctype html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>Potager</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser-ce@2.10.3/build/phaser.min.js"></script>
</head>

<body>
  <script type="text/javascript">
  window.onload = function() {

    //  Note that this html file is set to pull down Phaser 2.5.0 from the JS Delivr CDN.
    //  Although it will work fine with this tutorial, it's almost certainly not the most current version.
    //  Be sure to replace it with an updated version before you start experimenting with adding your own code.

    const TARGET_WIDTH = Math.floor(1920 / 2 * 0.9);

    const CELL_SIZE = 32;

    const HUD_CELL_SIZE = 64;

    const ASPECT_RATIO = 16 / 10;

    const COLS = Math.floor(TARGET_WIDTH / CELL_SIZE);
    const LIGS = Math.floor(COLS / ASPECT_RATIO);

    const HUD_COLS = Math.floor(TARGET_WIDTH / HUD_CELL_SIZE);
    const HUD_LIGS = Math.floor(HUD_COLS / ASPECT_RATIO);

    var width = COLS * CELL_SIZE;
    var height = LIGS * CELL_SIZE;

    console.log("COLS : " + COLS);
    console.log("LIGS : " + LIGS);

    var cell = { type: 0 };

    var gameGrid = [];

    for (let lig = 0; lig < LIGS; ++lig) {

      gameGrid.push([]);

      for (let col = 0; col < COLS; ++col) {

        gameGrid[lig].push(cell);

      }

    }

    var game = new Phaser.Game(width, height, Phaser.CANVAS, '', { preload: preload, create: create });

    function preload() {


      game.canvas.oncontextmenu = function(e) { e.preventDefault(); }

      game.load.image('ground_32x32', 'assets/tiles.png');
      game.load.image('tools_64x64', 'assets/farm_tool_icons_calciumtrice.png');

    }

    var map;
    var layer1;
    var layer2;
    var hudLayer;

    function create() {


      //  Creates a blank tilemap
      map = game.add.tilemap();

      toolsMap = game.add.tilemap(null, HUD_CELL_SIZE, HUD_CELL_SIZE);

      //  Add a Tileset image to the map
      map.addTilesetImage('ground_32x32');
      toolsMap.addTilesetImage('tools_64x64');

      //  Creates a new blank layer and sets the map dimensions.
      //  In this case the map is COLS x LIGS tiles in size and the tiles are CELL_SIZE x CELL_SIZE pixels in size.
      layer1 = map.create('level1', COLS, LIGS, CELL_SIZE, CELL_SIZE);

      //  Our painting marker
      marker = game.add.graphics();
      marker.lineStyle(2, 0x000000, 1);
      marker.drawRect(0, 0, 32, 32);

      game.input.addMoveCallback(updateMarker, this);


      map.fill(0, 0, 0, COLS, LIGS);

      layer2 = map.createBlankLayer('level2', COLS, LIGS, CELL_SIZE, CELL_SIZE);

      hudLayer = toolsMap.create('hud', HUD_COLS, HUD_LIGS, HUD_CELL_SIZE, HUD_CELL_SIZE);

      toolsMap.putTile(2, Math.floor(HUD_COLS / 2), HUD_LIGS - 1, hudLayer);

      // game.add.sprite(0, 0, game.create.grid('grid', width, height, CELL_SIZE, CELL_SIZE, 'rgba(0, 250, 0, 1)'));

    }

    function updateMarker() {

      marker.x = layer1.getTileX(game.input.activePointer.worldX) * 32;
      marker.y = layer1.getTileY(game.input.activePointer.worldY) * 32;

      if (game.input.activePointer.leftButton.isDown) {

        console.log('left click');
        map.putTile(1, layer2.getTileX(marker.x), layer2.getTileY(marker.y), layer2);

      }

      if (game.input.activePointer.rightButton.isDown) {


        console.log('right click');
        map.removeTile(layer2.getTileX(marker.x), layer2.getTileY(marker.y), layer2);

      }

    }

  };

  </script>
</body>

</html>
